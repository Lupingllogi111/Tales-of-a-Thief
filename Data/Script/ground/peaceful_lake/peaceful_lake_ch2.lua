require 'common'
require 'CommonFunctions'
peaceful_lake_ch = {}

function peaceful_lake_ch.firstLakeIntro()
    local partner = CH('Teammate1')
    local player = CH('PLAYER')

    GAME:CutsceneMode(true)
    AI:DisableCharacterAI(partner)
    GAME:MoveCamera(192, 310, 1, false)

    GAME:WaitFrames(60)
    GAME:FadeIn(20)


    local coro1 = TASK:BranchCoroutine(function() GROUND:MoveToPosition(player, 172, 337, false, 1.5)  end)
    local coro2 = TASK:BranchCoroutine(function() GROUND:MoveToPosition(partner, 172, 361, false, 1.5) end)

    TASK:JoinCoroutines({coro1,coro2})
    GAME:WaitFrames(40)
    local coro1 = TASK:BranchCoroutine(function() GROUND:CharTurnToCharAnimated(player, partner, 4)  end)
    local coro2 = TASK:BranchCoroutine(function() GROUND:CharTurnToCharAnimated(partner, player, 4) end)
    TASK:JoinCoroutines({coro1,coro2})
    GAME:WaitFrames(40)
    CommonFunctions.Dialogue(player, 3, "Worried", "Where have you taken me?")
    CommonFunctions.Dialogue(partner, 3, "Normal", "Just look behind you.")
    SOUND:PlaySE('Battle/EVT_Emote_Confused_2')
    GROUND:CharSetEmote(player, "question", 1)
    GAME:WaitFrames(100)
    GROUND:CharAnimateTurn(player, Direction.Up, 4, false)
    GAME:WaitFrames(50)
	SOUND:PlaySE('Battle/EVT_Emote_Exclaim')
	GROUND:CharSetEmote(player, "notice", 1)
    local mrkr1 = MRKR('mrkr_cut1')
    local mrkr2 = MRKR('mrkr_cut2')

   
    GAME:MoveCamera(192, 172, 40, false)

    GROUND:MoveToPosition(player, mrkr1.Position.X, mrkr1.Position.Y, false, 1.5)
    SOUND:PlayBGM("On the Beach at Dusk.ogg", true)
    GAME:WaitFrames(40)
    CommonFunctions.Dialogue(player, 3, "Inspired", "Woah...")
    CommonFunctions.Dialogue(player, 3, "Inspired", "It's beautiful...")
    GROUND:MoveToPosition(partner, mrkr2.Position.X, mrkr2.Position.Y, false, 1.5)
    GAME:WaitFrames(40)
    CommonFunctions.Dialogue(partner, 3, "Normal", "I know, right?")
    GROUND:CharTurnToCharAnimated(partner, player, 4)
    CommonFunctions.Dialogue(partner, 3, "Normal", "This is my special place.[br]Not too far from our hideout, but still not close enough for the rest of the members to care about it.")
    CommonFunctions.Dialogue(partner, 3, "Happy", "It's my secret home away from home!")

    GAME:MoveCamera(192, player.Position.Y, 40, false)

    GROUND:CharTurnToCharAnimated(player, partner, 4)

    CommonFunctions.Dialogue(partner, 3, "Sad", "I always come here whenever I'm feling down,[pause=30] mostly those times I really wished I had a partner with me...")
    CommonFunctions.Dialogue(partner, 3, "Happy", "But hopefully now that you're here I won't need to be here that much!")
    GAME:WaitFrames(80)
    GROUND:CharTurnToCharAnimated(player, partner, 4)
    CommonFunctions.Dialogue(player, 3, "Worried", "But why did you take me here?")
    CommonFunctions.Dialogue(player, 3, "Worried", "I thought this was your place?")
    CommonFunctions.Dialogue(player, 3, "Worried", "Why show it to me?")
    GAME:WaitFrames(40)

    GROUND:CharTurnToCharAnimated(partner, player, 4)
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(partner, 3, "Happy", "Well,[pause=40] we're partners now, aren't we?")
    CommonFunctions.Dialogue(partner, 3, "Happy", "It's only fair I share it with you so you can use it as much as I did!")
    CommonFunctions.Dialogue(partner, 3, "Worried", "Maybe you can come and try to remember something about your amnesia someday...")

    GROUND:CharAnimateTurn(partner, Direction.Up, 4, false)
    GAME:WaitFrames(60)

    CommonFunctions.Dialogue(partner, 3, "Normal", "Hopefully it will help you as much as it helped me.")
    CommonFunctions.Dialogue(partner, 3, "Worried", "Just...[pause=40] don't tell anyone,[pause=20] okay?")
    GAME:WaitFrames(60)

    GROUND:CharAnimateTurn(player, Direction.Up, 4, true)
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(player, 3, "Normal", "Okay, " ..partner:GetDisplayName().."!")
    CommonFunctions.Dialogue(player, 3, "Happy", "You secret is safe with me!")
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(partner, 3, "Happy", "I'll trust you with it, " ..player:GetDisplayName().."!")
    GAME:WaitFrames(30)
    CommonFunctions.Dialogue(player, 3, "Worried", "Trust...")
    GAME:WaitFrames(70)
    GROUND:CharTurnToCharAnimated(player, partner, 4)
    CommonFunctions.Dialogue(player, 3, "Worried", partner:GetDisplayName()..",[pause=40] there's something I should tell you.")
    CommonFunctions.Dialogue(player, 3, "Pain", "But you have to promise me that you won't tell anyone, okay?")
    GAME:WaitFrames(70)

    GROUND:CharTurnToCharAnimated(partner, player, 4)
    CommonFunctions.Dialogue(partner, 3, "Happy", "Of course, " ..player:GetDisplayName().."!")

    GAME:WaitFrames(70)
    CommonFunctions.Dialogue(player, 3, "Sigh", "Alright...")
    GAME:WaitFrames(90)
    CommonFunctions.Dialogue(player, 3, "Worried", "So remember how I freaked out when we first met?")
    GAME:WaitFrames(70)
    CommonFunctions.Dialogue(partner, 3, "Worried", "You mean you spitting that nonsense about being a human?")
    GAME:WaitFrames(70)
    CommonFunctions.Dialogue(player, 3, "Worried", "Yeah...")
    CommonFunctions.Dialogue(player, 3, "Worried", "The thing is...[pause=50] it's not nonsense.")
    CommonFunctions.Dialogue(player, 3, "Worried", "It's...[pause=50] really true.")


    SOUND:PlaySE('Battle/EVT_Emote_Exclaim')
	GROUND:CharSetEmote(partner, "notice", 1)
    GAME:WaitFrames(100)
    CommonFunctions.Dialogue(partner, 3, "Worried", "True?")
    CommonFunctions.Dialogue(partner, 3, "Worried", "In what sense?")
    GAME:WaitFrames(70)
    CommonFunctions.Dialogue(player, 3, "Worried", "I'm saying that...")
    CommonFunctions.Dialogue(player, 3, "Normal", "I'm a human.")
    GAME:WaitFrames(90)
    CommonFunctions.Dialogue(partner, 3, "Worried", "You're a human?")
    GAME:WaitFrames(90)
    CommonFunctions.Dialogue(player, 3, "Stunned", "Look, I know it may be hard to believe when I look like this,[pause=30] but I'm telling the truth!")
    CommonFunctions.Dialogue(player, 3, "Pain", "I think that's why I have amnesia, but I don't know how or why!")
    CommonFunctions.Dialogue(player, 3, "Pain", "I don't know how I even turned into a [color=#00ff00]Riolu[color]!")

    GAME:WaitFrames(100)
    CommonFunctions.Dialogue(partner, 3, "Worried", "...")
    GAME:WaitFrames(70)
    CommonFunctions.Dialogue(partner, 3, "Worried", "Are you...[pause=40] pulling my leg?")
    GAME:WaitFrames(50)
    CommonFunctions.Dialogue(player, 2, "Pain", "(Of course she doesn't believe me...)")
    CommonFunctions.Dialogue(player, 2, "Sad", "(Now " .. partner:GetDisplayName() .. "'s going to think I'm crazy or something...)")
    GAME:WaitFrames(90)
    CommonFunctions.Dialogue(partner, 2, "Worried", "(He doesn't look like he's lying...)")
    CommonFunctions.Dialogue(partner, 2, "Worried", "(It sounds crazy but...)")
    CommonFunctions.Dialogue(partner, 2, "Worried", "(It couldn't hurt to believe him,[pause=40] right?)")
    GAME:WaitFrames(70)
    CommonFunctions.Dialogue(partner, 2, "Pain", "(Geez, " .. partner:GetDisplayName() .. "![pause=0] You found him fainted at the end of a Mystery Dungeon!)[br](Knowing that, everything is possible!)")
    GAME:WaitFrames(80)
    CommonFunctions.Dialogue(partner, 3, "Worried", "Well,[pause=40] thinking about it...")
    SOUND:PlaySE('Battle/EVT_Emote_Exclaim')
	GROUND:CharSetEmote(player, "notice", 1)
    GAME:WaitFrames(90)
    CommonFunctions.Dialogue(partner, 3, "Happy", "I'll believe you!")
    GROUND:CharSetEmote(partner, "happy", 0)
    CommonFunctions.Dialogue(partner, 3, "Joyous", "That just gives me the explanation I needed as to why you're this weird sometimes!")

    GAME:WaitFrames(40)
    GROUND:CharSetEmote(partner, "happy", 1)
    GAME:WaitFrames(70)
    CommonFunctions.Dialogue(partner, 3, "Worried", "Weird in a good way, I mean.")
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(player, 3, "Stunned", "Wait, really?")
    CommonFunctions.Dialogue(player, 3, "Stunned", "Just like that?")
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(partner, 3, "Happy", "Well, you certainly don't act like a regular Pok√©mon sometimes,[pause=20] so there has to be another explanation!")
    CommonFunctions.Dialogue(partner, 3, "Worried", "Though I must say that humans are legends around here, so be careful who you tell this to.")
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(player, 3, "Stunned", "Oh...")
    CommonFunctions.Dialogue(player, 3, "Normal", "Well, thanks for believing me anyway, " .. partner:GetDisplayName() .. ".")
    CommonFunctions.Dialogue(partner, 3, "Normal", "No problem, " .. player:GetDisplayName()..".")
    GAME:WaitFrames(70)
    CommonFunctions.Dialogue(player, 3, "Worried", "So what were you talking about back in [color=#00ffff]Ma'am[color]'s office?")
    CommonFunctions.Dialogue(player, 3, "Worried", "That thing about the tresure you've been looking for.")
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(partner, 3, "Worried", "Oh, yeah.[br]If you're a human you have probably not heard about the legend of the [color=#fcacac]Plate of Wonders[color], right?")
    SOUND:FadeOutBGM(50)

    CommonFunctions.Dialogue(player, 3, "Worried", "[color=#fcacac]Plate of Wonders[color]?")
    CommonFunctions.Dialogue(partner, 3, "Normal", "Yes.")
    SOUND:PlayBGM("Time gears.ogg", true)
    CommonFunctions.Dialogue(partner, 3, "Normal", "Legends say it's an immensely powerful artifact that was created as the key for a vault.")
    CommonFunctions.Dialogue(player, 3, "Worried", "A vault?")
    CommonFunctions.Dialogue(partner, 3, "Normal", "Yeah, but not just any regular vault.[br]The vault this plate opens is said to contain a very big treasure.")
    GAME:WaitFrames(50)
    CommonFunctions.Dialogue(player, 3, "Worried", "How big?")
    GAME:WaitFrames(50)
    CommonFunctions.Dialogue(partner, 3, "Worried", "No one really knows.[br]What's inside is still a mystery for everyone.")
    CommonFunctions.Dialogue(player, 3, "Stunned", "But then how does everyone know it's that big of a treasure if they have never seen it?")
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(partner, 3, "Worried", "History.")
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(partner, 3, "Normal", "You see,[pause=40] the [color=#fcacac]Plate of Wonders[color] was first created as a security measure to stop anyone from entering that vault.")
    CommonFunctions.Dialogue(partner, 3, "Normal", "Supposedly, it was to protect the place where one of the most notorious outlaws of that time hid their treasure.")
    --Thinking about the lore while at school is crazy.
    CommonFunctions.Dialogue(partner, 3, "Worried", "But no one really knows what that treasure is...")
    CommonFunctions.Dialogue(partner, 3, "Normal", "What we do know is that the tablet was broken in three pieces, and those pieces were scattered around the world.")
    CommonFunctions.Dialogue(partner, 3, "Happy", "It has to be a big treasure for that to happen!")
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(partner, 3, "Normal", "Each piece is also supposed to have some sort of inscription written on it.")
    CommonFunctions.Dialogue(partner, 3, "Worried", "That's why [color=#00ffff]Ma'am[color] was so shocked to find that we may have stolen one of those pieces from an archaeologist.")
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(player, 3, "Worried", "So we basically have a piece of a key to an ancient treasure, right?")
    CommonFunctions.Dialogue(partner, 3, "Happy", "If [color=#00ffff]Ma'am[color]'s theory is correct, then yes!")
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(player, 3, "Worried", "Where's that vault?[br]Maybe we could find clues there.")
    GAME:WaitFrames(60)

    CommonFunctions.Dialogue(partner, 3, "Worried", "No one knows where the vault is located.[br]If anyone did, it would have been filled to the brim with police or explorers.")
    CommonFunctions.Dialogue(player, 3, "Worried", "And no openings for us to investigate...")
    SOUND:FadeOutBGM(50)
    GAME:WaitFrames(60)
    CommonFunctions.Dialogue(player, 3, "Normal", "Okay.[br]I think I got it.")
    CommonFunctions.Dialogue(player, 3, "Normal", "So [color=#00ffff]Ma'am[color] thinks that the chest we gave her could contain one of the pieces of the tablet,[pause=40] so she sent it to one of her and [color=#00ffff]Jacques[color]'s friend to see if they can open it?")
    CommonFunctions.Dialogue(partner, 3, "Normal", "Exactly!")
    GAME:WaitFrames(60)
    local coro1 = TASK:BranchCoroutine(function()  GROUND:CharAnimateTurn(player, Direction.Up, 4, true)  end)
    local coro2 = TASK:BranchCoroutine(function()  GROUND:CharAnimateTurn(partner, Direction.Up, 4, false) end)
    TASK:JoinCoroutines({coro1,coro2})
    GAME:WaitFrames(60)

    CommonFunctions.Dialogue(partner, 3, "Normal", player:GetDisplayName()..",[pause=40] what do you say if we stay here for a little longer and then go have dinner?")
    CommonFunctions.Dialogue(player, 3, "Normal", "That sounds like a great idea.")
    GAME:WaitFrames(60)

    
    GAME:CutsceneMode(false)

    SV.guild.having_dinner = true
    GAME:FadeOut(false,20)
    GAME:MoveCamera(0, 0, 1, true)

    GAME:WaitFrames(60)
    GAME:EnterZone('thieves_hideout', -1, 8, 1)
end